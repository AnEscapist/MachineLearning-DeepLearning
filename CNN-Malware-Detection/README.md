# Convolutional Neural Network and Malware Detection With CNN
## CNN-Introduction
Convolutional Neural Networks (CNNs) are a deep learning approach to tackle the image classification problem, or what we call computer vision problems, because classic computer programs face many challenges and difficulties to identify objects for many reasons, including lighting, viewpoint, deformation and segmentation.

This technique is inspired by how the eye works, especially the visual cortex function algorighm in animals. CNNs are arranged in three-dimensional structures with width, height, and depth as characteristics. In the case of images, the height is the image height, the width is the image width, and the depth is RGB channels.

To build a CNN, we need three main types of layers:

**Convolutional layer:** A convolutional operation refers to extracting features from the input image and multiplying the values in the filter with the original pixel values.

**Pooling layer:** The pooling operation reduces the dimensionality of each feature map.

**Fully-connected layer:** The fully connected layer is a classic multi-layer perceptrons with a softmax activation function in the output layer.

## Understanding of CNN 

**Reference: https://medium.com/@RaghavPrabhu/understanding-of-convolutional-neural-network-cnn-deep-learning-99760835f148**

CNN image classifications takes an input image, process it and classify it under certain categories (e.g. dog, cat, tiger, lion, etc.). Computers see an image as array of pixels and it depends on the image resolution. Based on the image resolution, it will see h * w * d (h = height, w = width, d = dimension). For example, an image of 6 * 6 * 3 array of matrix represents a RGB (3 refers to RGB values) image and an image of 4 * 4 * 1 array of matrix is a grayscale image.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/RGB.PNG)

Technically, deep learning CNN models to train and test, each input image will pass it through a series of convolution layers with filters (kernels), pooling, fully connected layers and apply softmax function to classify an object with probabilistic values between 0 and 1. The figure below is a complete flow of CNN to process an input image and classify the objects based on values.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/CNN-layers.PNG)

**Convolution layer**
Convolution is the first layer to extract features from an input image. Convolution preserves the relationship between pixels by learningimage features using small squares of input data. It is a mathematical operation that takes two inputs such as image matrix and a filter or kernel.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/Convolution%20operation.PNG)

Consider a 5 * 5 image with pixel values are 0, 1 and a 3 * 3 filter matrix as shown below:
![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/eg-convolution.PNG)

Then the convolution of 5 * 5 image with 3 * 3 filter which is called "Feature Map" is shown as:

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/Convolution.gif)

Convolution of an image with different filters can perform operations such as edge detection, blur and sharpen by applying filters. Figure 7 shows an example of various convolution image after applying different types of filters (kernels).

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/CNN-Kernels.PNG)

**Strides**

Stride is the number of pixels shifts over the input matrix. When the stride is 1 then we move the filters to 1 pixel at a time. When the stride is 2 then we move the filters to 2 pixels at a time and so on. The following figure shows how convolution would work with a stride of 2.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/Stride.PNG)

**Padding**

Sometimes filter doesn't perfectly fit the input image. We have two options:
* Pad the picturewith zeros (zero-padding) so that it fits.
* Drop the part of the image where the filter didn't fit. This is called valid padding which keeps only valid part of the image.

**Non Linearity (ReLU)**
ReLU stands for Rectified Linear Unit for a non-linear operation. The output is **f(x)=max(0, x)**. 

Why ReLU is important: ReLU's purpose is to introduce non-linearity in our CNN. Since the real world data would want our CNN to learn non-negative linear values.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/ReLU.PNG)

There are other non-linear functions such as tanh or sigmoid that can also be used instead of ReLU. However, most of the data scientists use ReLU since the performance of ReLU is better than the other two.

**Pooling layer**

Pooling layers would reduce the number of parameters when the images are too large. Spatial pooling also called subsampling or downsampling which reduces the dimensionality of each map but retains the important information. Spatial pooling can be off different types:

* Max pooling
* Average pooling
* Sum pooling

Max pooling take the largest element from the rectified feature maps. Taking the largest element could also take the average pooling. Sum of all elements in the feature map is sum pooling.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/CNN-MaxPooling.PNG)

**Fully Connected Layer**

The layer we call as FC layer, we flattened our matrix into vector and feed it into a fully connected layer like neural network.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/CNN-FullyConnected.PNG)

In the above diagram, feature map matrix will be converted as vector (x1, x2, x3 ...). With the fully connected layers, we combined these features together to create a model. Finally, we have an activation function such as softmax or sigmoid to classify the outputs as cat, dog, car, truck, etc.

![image](https://github.com/AnEscapist/MachineLearning-DeepLearning/blob/master/CNN-Malware-Detection/images/CNN-Complete.PNG)

**Summary of CNN concept**

* Provide input image into convolution layer
* Choose parameters, apply filters with strides, padding if required. Perform convolution on the image and apply ReLU activation to the matrix.
* Perform pooling to reduce dimensionality size
* Add as many convolutional layers until satisfied
* Flatten the output and feed into a fully connected layer (FC layer)
* Output the class using an activation function (Logistic Regression with cost functions) and classifies images.





































































